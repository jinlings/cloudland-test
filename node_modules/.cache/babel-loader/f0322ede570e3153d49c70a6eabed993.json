{"ast":null,"code":"import _classCallCheck from\"/Users/emily/cloudland/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/emily/cloudland/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/emily/cloudland/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/emily/cloudland/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/emily/cloudland/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";/*\n\nCopyright <holder> All Rights Reserved\n\nSPDX-License-Identifier: Apache-2.0\n\n*/import React,{Component}from\"react\";import{Card,Table,Button,Popconfirm,Pagination,Row,Col,Menu,Dropdown,message,Modal}from\"antd\";import{insListApi,delInsInfor,getInsInforById,editInsInfor}from\"../../service/instances\";import DataTable from\"../../components/DataTable/DataTable\";import InstModal from\"./InstModal\";import\"./instances.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Instances=/*#__PURE__*/function(_Component){_inherits(Instances,_Component);var _super=_createSuper(Instances);function Instances(props){var _this2;_classCallCheck(this,Instances);_this2=_super.call(this,props);_this2.columns=[{title:\"ID\",key:\"ID\",width:60,align:\"center\",dataIndex:\"ID\"},{title:\"HostName\",dataIndex:\"Hostname\",align:\"center\"},{title:\"Flavor\",dataIndex:\"Flavor.Name\",align:\"center\"},{title:\"Image\",dataIndex:\"Image.Name\",align:\"center\"},{title:\"IP Address\",dataIndex:\"Interfaces\",key:Math.random(),align:\"center\",render:function render(Interfaces){return/*#__PURE__*/_jsx(\"span\",{children:Interfaces.map(function(iface){return iface.Address.Address+\" \";})});}},{title:\"Console\",dataIndex:\"\",align:\"center\"},{title:\"Status\",dataIndex:\"Status\",align:\"center\"},{title:\"Hyper\",dataIndex:\"Hyper\",align:\"center\"},{title:\"Owner\",dataIndex:\"Interfaces\",align:\"center\",render:function render(Interfaces){return/*#__PURE__*/_jsx(\"span\",{children:Interfaces.map(function(iface){return iface.Secgroups[0].Name;})});}},{title:\"Zone\",dataIndex:\"Zone.Name\",align:\"center\"},{title:\"Action\",align:\"center\",render:function render(txt,record,index){return/*#__PURE__*/_jsxs(\"div\",{className:\"actionStyle\",children:[/*#__PURE__*/_jsx(Dropdown.Button,{type:\"primary\",onClick:function onClick(){console.log(\"onClick:\",record);_this2.props.history.push(\"/instances/new/\"+record.ID);},overlay:_this2.menu(record.ID),children:\"Edit\"}),/*#__PURE__*/_jsx(Popconfirm,{title:\"Are you sure to delete?\",onCancel:function onCancel(){console.log(\"cancelled\");},onConfirm:function onConfirm(){console.log(\"onClick-delete:\",record);delInsInfor(record.ID).then(function(res){message.success(res.Msg);_this2.loadData(_this2.state.current,_this2.state.pageSize);console.log(\"用户~~\",res);console.log(\"用户~~state\",_this2.state);});},children:/*#__PURE__*/_jsx(Button,{style:{margin:\"5px\",marginRight:\"0px\",marginTop:\"10px\",height:\"32px\"},type:\"danger\",size:\"small\",children:\"Delete\"})})]});}}];_this2.menu=function(r){return/*#__PURE__*/_jsxs(Menu,{onClick:_this2.handleModal.bind(_assertThisInitialized(_this2),r),children:[/*#__PURE__*/_jsx(Menu.Item,{children:\"Change Hostname\"},\"changeHostname\"),/*#__PURE__*/_jsx(Menu.Item,{children:\"Migrate Instance\"},\"migrateIns\"),/*#__PURE__*/_jsx(Menu.Item,{children:\"Resize Instance\"},\"resizeIns\"),/*#__PURE__*/_jsx(Menu.Item,{children:\"Change Status\"},\"changeStatus\"),/*#__PURE__*/_jsx(Menu.Item,{children:\"Start VM\"},\"startVm\"),/*#__PURE__*/_jsx(Menu.Item,{children:\"Stop VM\"},\"stopVm\")]});};_this2.handleModal=function(id,_ref){var key=_ref.key;console.log(\"handleModal-key\",key);_this2.handleChange(id);console.log(\"handleModal\",id);if(key===\"changeHostname\"||key===\"migrateIns\"||key===\"resizeIns\"){_this2.setState({visible:!_this2.state.visible});}else if(key===\"changeStatus\"){_this2.setState({visible:!_this2.state.visible,flag:\"ChangeStatus\"});}else if(key===\"startVm\"){_this2.setState({flag:\"ChangeStatus\",action:\"start\"},function(){insListApi({flag:_this2.state.flag,action:_this2.state.action}).then(function(res){console.log(\"startVm\",res);}).catch(function(error){console.log(error);});message.success(\"Start VM successfully\");});}else{_this2.setState({flag:\"ChangeStatus\",action:\"shutdown\"},function(){insListApi({flag:_this2.state.flag,action:_this2.state.action}).then(function(res){console.log(\"stopVm\",res);}).catch(function(error){console.log(error);});message.success(\"Stop VM successfully\");});}if(key){switch(key){case\"changeHostname\":return _this2.setState({menuKey:key,title:\"Change Hostname\"});case\"migrateIns\":return _this2.setState({menuKey:key,title:\"Migrate Instance\"});case\"resizeIns\":return _this2.setState({menuKey:key,title:\"Resize Instance\"});case\"changeStatus\":return _this2.setState({title:\"Change Status\"});case\"startVm\":return _this2.setState({title:\"Start VM\"});case\"stopVm\":return _this2.setState({title:\"Stop VM\"});default:return null;}}};_this2.handleChange=function(id){getInsInforById(id).then(function(res){console.log(\"handleChange-getInsInforById-res:\",res);_this2.setState(function(sta){return sta.everyData=res.instance;});console.log(\"handleChange-state.everyData\",_this2.state);});};_this2.onCancel=function(){console.log(\"cancel\");_this2.setState({visible:false,key:Math.random()});};_this2.handleOk=function(){console.log(\"ok\");_this2.setState({visible:false,key:Math.random()});};_this2.loadData=function(page,pageSize){console.log(\"ins-loadData~~\",page,pageSize);var _this=_assertThisInitialized(_this2);var offset=(page-1)*pageSize;var limit=pageSize;insListApi(offset,limit).then(function(res){console.log(\"loadData\",res);_this.setState({instances:res.instances,isLoaded:true,total:res.total,pageSize:limit,current:page});console.log(\"loadData-page-\",page,_this.state);}).catch(function(error){_this.setState({isLoaded:false,error:error});});};_this2.toSelectchange=function(page,num){console.log(\"toSelectchange\",page,num);var _this=_assertThisInitialized(_this2);var offset=(page-1)*num;var limit=num;console.log(\"instance-toSelectchange~limit:\",offset,limit);insListApi(offset,limit).then(function(res){console.log(\"loadData\",res);_this.setState({instances:res.instances,isLoaded:true,total:res.total,pageSize:limit,current:page});}).catch(function(error){_this.setState({isLoaded:false,error:error});});};_this2.onPaginationChange=function(e){console.log(\"onPaginationChange\",e);_this2.loadData(e,_this2.state.pageSize);};_this2.onShowSizeChange=function(current,pageSize){console.log(\"onShowSizeChange:\",current,pageSize);//当几条一页的值改变后调用函数，current：改变显示条数时当前数据所在页；pageSize:改变后的一页显示条数\n_this2.toSelectchange(current,pageSize);};_this2.createInstance=function(){_this2.props.history.push(\"/instances/new\");};_this2.onRef=function(selectedRowKeys,selectedRows,selectedIds){_this2.setState({selectedRowKeys:selectedRowKeys,selectedRows:selectedRows,selectedIds:selectedIds});};_this2.onModalRef=function(ref){_this2.modalRef=ref;};_this2.modalFormList=function(data){console.log(\"instance-modalFormList\",data);console.log(\"key-modalFormList\",_this2.state.menuKey);var modalFormList=[{type:\"INPUT\",label:\"Hostname\",name:\"hostname\",field:\"Change Hostname\",placeholder:\"Please input Hostname\",width:\"90%\",initialValue:data.Hostname,id:data.ID},{type:\"SELECT\",width:\"200px\",label:\"Hyper\",name:\"hyper\",field:\"Migrate Instance\",// disabled:true,\ninitialValue:data.Hyper,id:data.ID},{type:\"SELECT\",width:\"200px\",label:\"Flavor\",field:\"Resize Instance\",name:\"flavor\",initialValue:data.FlavorID,id:data.ID},{type:\"SELECT\",label:\"Action\",name:\"action\",field:\"Change Status\",placeholder:\"Please Select Status\",width:\"90%\",// disabled:true,\ninitialValue:data.Status,id:data.ID}];return modalFormList;};_this2.handleSubmit=function(data){var id=_this2.state.everyData&&_this2.state.everyData.ID;if(id){var hostname=_this2.state.everyData&&_this2.state.everyData.Hostname;var hyper=_this2.state.everyData&&_this2.state.everyData.Hyper;var action=_this2.state.everyData&&_this2.state.everyData.Status;var flavor=_this2.state.everyData&&_this2.state.everyData.FlavorID;// const ifaces = this.state.everyData.Interfaces[0].Address.SubnetID;\nvar ifaces=[];_this2.state.everyData&&_this2.state.everyData.Interfaces.map(function(item){ifaces.push(\"\".concat(item.Address.SubnetID));return ifaces;});var initInstance={};initInstance[\"hostname\"]=hostname;initInstance[\"hyper\"]=hyper;initInstance[\"action\"]=action;initInstance[\"flavor\"]=flavor;initInstance[\"ifaces\"]=ifaces;_this2.setState({updateInstance:initInstance},function(){if(data.hostname){initInstance.hostname=data.hostname;}else if(data.hyper){initInstance.hyper=data.hyper;}else if(data.flavor){initInstance.flavor=data.flavor;}else if(data.action){initInstance.action=data.action;}var dataInstance=Object.assign({},_this2.state.updateInstance,initInstance,data);console.log(\"dataInstance\",dataInstance);_this2.handleUpdateList(id,dataInstance);});}};_this2.handleUpdateList=function(id,paramsObj){console.log(\"hangleUpdateList\",paramsObj,id);if(id){editInsInfor(id,paramsObj).then(function(res){// let _json = res.data;\n// if (_json.return_code === \"0\") {\nconsole.log(\"handleUpdateList-editInsInfor:\",res);// } else {\n//   message.error(res.message);\n// }\n_this2.loadData(_this2.state.current,_this2.state.pageSize);}).catch(function(err){console.log(\"handleUpdateList-error:\",err);});}_this2.modalRef.props.form.resetFields();_this2.setState({visible:false});};_this2.state={updateInstance:{},selectedRowKeys:[],instances:[],isLoaded:false,total:0,pageSize:10,offset:0,pageSizeOptions:[\"5\",\"10\",\"15\",\"20\"],current:1,visible:false,everyData:{},menuKey:\"\",flag:\"\",action:\"\"};return _this2;}_createClass(Instances,[{key:\"componentWillMount\",value:function componentWillMount(){var _this=this;insListApi().then(function(res){console.log(\"componentDidMount-instances:\",res);_this.setState({instances:res.instances,isLoaded:true,total:res.total});}).catch(function(error){_this.setState({isLoaded:false,error:error});});}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,data=_this$state.data,everyData=_this$state.everyData;console.log(data,\"data\");return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Card,{title:\"Instance Manage Panel\"+\"(Total: \"+this.state.total+\")\",extra:/*#__PURE__*/_jsx(Button,{type:\"primary\",size:\"small\",onClick:this.createInstance,children:\"Create\"}),children:/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Col,{span:24,children:[/*#__PURE__*/_jsx(DataTable,{rowKey:\"ID\",columns:this.columns,dataSource:this.state.instances,bordered:true,total:this.state.total,pageSize:this.state.pageSize// scroll={{ y: 600, x: 600 }}\n,onPaginationChange:this.onPaginationChange,onShowSizeChange:this.onShowSizeChange,pageSizeOptions:this.state.pageSizeOptions,loading:!this.state.isLoaded}),/*#__PURE__*/_jsx(InstModal,{onRef:this.onModalRef,visible:this.state.visible,modalFormList:this.modalFormList(everyData),title:this.state.title,submit:this.handleSubmit.bind(this),close:function close(){_this3.setState({visible:false,everyData:{}});_this3.modalRef.props.form.resetFields();}})]})})})})})});}}]);return Instances;}(Component);export default Instances;","map":{"version":3,"sources":["/Users/emily/cloudland/src/pages/instances/Instances.jsx"],"names":["React","Component","Card","Table","Button","Popconfirm","Pagination","Row","Col","Menu","Dropdown","message","Modal","insListApi","delInsInfor","getInsInforById","editInsInfor","DataTable","InstModal","Instances","props","columns","title","key","width","align","dataIndex","Math","random","render","Interfaces","map","iface","Address","Secgroups","Name","txt","record","index","console","log","history","push","ID","menu","then","res","success","Msg","loadData","state","current","pageSize","margin","marginRight","marginTop","height","r","handleModal","bind","id","handleChange","setState","visible","flag","action","catch","error","menuKey","sta","everyData","instance","onCancel","handleOk","page","_this","offset","limit","instances","isLoaded","total","toSelectchange","num","onPaginationChange","e","onShowSizeChange","createInstance","onRef","selectedRowKeys","selectedRows","selectedIds","onModalRef","ref","modalRef","modalFormList","data","type","label","name","field","placeholder","initialValue","Hostname","Hyper","FlavorID","Status","handleSubmit","hostname","hyper","flavor","ifaces","item","SubnetID","initInstance","updateInstance","dataInstance","Object","assign","handleUpdateList","paramsObj","err","form","resetFields","pageSizeOptions"],"mappings":"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","sourcesContent":["/*\n\nCopyright <holder> All Rights Reserved\n\nSPDX-License-Identifier: Apache-2.0\n\n*/\nimport React, { Component } from \"react\";\nimport {\n  Card,\n  Table,\n  Button,\n  Popconfirm,\n  Pagination,\n  Row,\n  Col,\n  Menu,\n  Dropdown,\n  message,\n  Modal,\n} from \"antd\";\nimport {\n  insListApi,\n  delInsInfor,\n  getInsInforById,\n  editInsInfor,\n} from \"../../service/instances\";\nimport DataTable from \"../../components/DataTable/DataTable\";\n\nimport InstModal from \"./InstModal\";\nimport \"./instances.css\";\n\nclass Instances extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      updateInstance: {},\n      selectedRowKeys: [],\n      instances: [],\n      isLoaded: false,\n      total: 0,\n      pageSize: 10,\n      offset: 0,\n      pageSizeOptions: [\"5\", \"10\", \"15\", \"20\"],\n      current: 1,\n      visible: false,\n      everyData: {},\n      menuKey: \"\",\n      flag: \"\",\n      action: \"\",\n    };\n  }\n\n  columns = [\n    {\n      title: \"ID\",\n      key: \"ID\",\n      width: 60,\n      align: \"center\",\n      dataIndex: \"ID\",\n    },\n    {\n      title: \"HostName\",\n      dataIndex: \"Hostname\",\n      align: \"center\",\n    },\n    {\n      title: \"Flavor\",\n      dataIndex: \"Flavor.Name\",\n      align: \"center\",\n    },\n    {\n      title: \"Image\",\n      dataIndex: \"Image.Name\",\n      align: \"center\",\n    },\n    {\n      title: \"IP Address\",\n      dataIndex: \"Interfaces\",\n      key: Math.random(),\n      align: \"center\",\n      render: (Interfaces) => (\n        <span>\n          {Interfaces.map((iface) => {\n            return iface.Address.Address + \" \";\n          })}\n        </span>\n      ),\n    },\n    {\n      title: \"Console\",\n      dataIndex: \"\",\n      align: \"center\",\n    },\n    {\n      title: \"Status\",\n      dataIndex: \"Status\",\n      align: \"center\",\n    },\n    {\n      title: \"Hyper\",\n      dataIndex: \"Hyper\",\n      align: \"center\",\n    },\n    {\n      title: \"Owner\",\n      dataIndex: \"Interfaces\",\n      align: \"center\",\n      render: (Interfaces) => (\n        <span>\n          {Interfaces.map((iface) => {\n            return iface.Secgroups[0].Name;\n          })}\n        </span>\n      ),\n    },\n    {\n      title: \"Zone\",\n      dataIndex: \"Zone.Name\",\n      align: \"center\",\n    },\n    {\n      title: \"Action\",\n      align: \"center\",\n      render: (txt, record, index) => {\n        return (\n          <div className=\"actionStyle\">\n            <Dropdown.Button\n              type=\"primary\"\n              onClick={() => {\n                console.log(\"onClick:\", record);\n                this.props.history.push(\"/instances/new/\" + record.ID);\n              }}\n              overlay={this.menu(record.ID)}\n            >\n              Edit\n            </Dropdown.Button>\n            <Popconfirm\n              title=\"Are you sure to delete?\"\n              onCancel={() => {\n                console.log(\"cancelled\");\n              }}\n              onConfirm={() => {\n                console.log(\"onClick-delete:\", record);\n                delInsInfor(record.ID).then((res) => {\n                  message.success(res.Msg);\n                  this.loadData(this.state.current, this.state.pageSize);\n\n                  console.log(\"用户~~\", res);\n                  console.log(\"用户~~state\", this.state);\n                });\n              }}\n            >\n              <Button\n                style={{\n                  margin: \"5px\",\n                  marginRight: \"0px\",\n                  marginTop: \"10px\",\n                  height: \"32px\",\n                }}\n                type=\"danger\"\n                size=\"small\"\n              >\n                Delete\n              </Button>\n            </Popconfirm>\n          </div>\n        );\n      },\n    },\n  ];\n  menu = (r) => (\n    <Menu onClick={this.handleModal.bind(this, r)}>\n      <Menu.Item key=\"changeHostname\">Change Hostname</Menu.Item>\n      <Menu.Item key=\"migrateIns\">Migrate Instance</Menu.Item>\n      <Menu.Item key=\"resizeIns\">Resize Instance</Menu.Item>\n      <Menu.Item key=\"changeStatus\">Change Status</Menu.Item>\n      <Menu.Item key=\"startVm\">Start VM</Menu.Item>\n      <Menu.Item key=\"stopVm\">Stop VM</Menu.Item>\n    </Menu>\n  );\n\n  handleModal = (id, { key }) => {\n    console.log(\"handleModal-key\", key);\n    this.handleChange(id);\n    console.log(\"handleModal\", id);\n    if (\n      key === \"changeHostname\" ||\n      key === \"migrateIns\" ||\n      key === \"resizeIns\"\n    ) {\n      this.setState({\n        visible: !this.state.visible,\n      });\n    } else if (key === \"changeStatus\") {\n      this.setState({\n        visible: !this.state.visible,\n        flag: \"ChangeStatus\",\n      });\n    } else if (key === \"startVm\") {\n      this.setState(\n        {\n          flag: \"ChangeStatus\",\n          action: \"start\",\n        },\n        () => {\n          insListApi({ flag: this.state.flag, action: this.state.action })\n            .then((res) => {\n              console.log(\"startVm\", res);\n            })\n            .catch((error) => {\n              console.log(error);\n            });\n          message.success(\"Start VM successfully\");\n        }\n      );\n    } else {\n      this.setState(\n        {\n          flag: \"ChangeStatus\",\n          action: \"shutdown\",\n        },\n        () => {\n          insListApi({ flag: this.state.flag, action: this.state.action })\n            .then((res) => {\n              console.log(\"stopVm\", res);\n            })\n            .catch((error) => {\n              console.log(error);\n            });\n          message.success(\"Stop VM successfully\");\n        }\n      );\n    }\n\n    if (key) {\n      switch (key) {\n        case \"changeHostname\":\n          return this.setState({\n            menuKey: key,\n            title: \"Change Hostname\",\n          });\n        case \"migrateIns\":\n          return this.setState({\n            menuKey: key,\n            title: \"Migrate Instance\",\n          });\n        case \"resizeIns\":\n          return this.setState({\n            menuKey: key,\n            title: \"Resize Instance\",\n          });\n        case \"changeStatus\":\n          return this.setState({\n            title: \"Change Status\",\n          });\n        case \"startVm\":\n          return this.setState({\n            title: \"Start VM\",\n          });\n        case \"stopVm\":\n          return this.setState({\n            title: \"Stop VM\",\n          });\n        default:\n          return null;\n      }\n    }\n  };\n\n  handleChange = (id) => {\n    getInsInforById(id).then((res) => {\n      console.log(\"handleChange-getInsInforById-res:\", res);\n      this.setState((sta) => (sta.everyData = res.instance));\n      console.log(\"handleChange-state.everyData\", this.state);\n    });\n  };\n  onCancel = () => {\n    console.log(\"cancel\");\n    this.setState({\n      visible: false,\n      key: Math.random(),\n    });\n  };\n  handleOk = () => {\n    console.log(\"ok\");\n    this.setState({\n      visible: false,\n      key: Math.random(),\n    });\n  };\n  componentWillMount() {\n    const _this = this;\n    insListApi()\n      .then((res) => {\n        console.log(\"componentDidMount-instances:\", res);\n        _this.setState({\n          instances: res.instances,\n          isLoaded: true,\n          total: res.total,\n        });\n      })\n      .catch((error) => {\n        _this.setState({\n          isLoaded: false,\n          error: error,\n        });\n      });\n  }\n  loadData = (page, pageSize) => {\n    console.log(\"ins-loadData~~\", page, pageSize);\n    const _this = this;\n    const offset = (page - 1) * pageSize;\n    const limit = pageSize;\n    insListApi(offset, limit)\n      .then((res) => {\n        console.log(\"loadData\", res);\n        _this.setState({\n          instances: res.instances,\n          isLoaded: true,\n          total: res.total,\n          pageSize: limit,\n          current: page,\n        });\n        console.log(\"loadData-page-\", page, _this.state);\n      })\n      .catch((error) => {\n        _this.setState({\n          isLoaded: false,\n          error: error,\n        });\n      });\n  };\n  toSelectchange = (page, num) => {\n    console.log(\"toSelectchange\", page, num);\n    const _this = this;\n    const offset = (page - 1) * num;\n    const limit = num;\n    console.log(\"instance-toSelectchange~limit:\", offset, limit);\n    insListApi(offset, limit)\n      .then((res) => {\n        console.log(\"loadData\", res);\n        _this.setState({\n          instances: res.instances,\n          isLoaded: true,\n          total: res.total,\n          pageSize: limit,\n          current: page,\n        });\n      })\n      .catch((error) => {\n        _this.setState({\n          isLoaded: false,\n          error: error,\n        });\n      });\n  };\n  onPaginationChange = (e) => {\n    console.log(\"onPaginationChange\", e);\n    this.loadData(e, this.state.pageSize);\n  };\n  onShowSizeChange = (current, pageSize) => {\n    console.log(\"onShowSizeChange:\", current, pageSize);\n    //当几条一页的值改变后调用函数，current：改变显示条数时当前数据所在页；pageSize:改变后的一页显示条数\n    this.toSelectchange(current, pageSize);\n  };\n\n  createInstance = () => {\n    this.props.history.push(\"/instances/new\");\n  };\n  onRef = (selectedRowKeys, selectedRows, selectedIds) => {\n    this.setState({\n      selectedRowKeys,\n      selectedRows,\n      selectedIds,\n    });\n  };\n  onModalRef = (ref) => {\n    this.modalRef = ref;\n  };\n  modalFormList = (data) => {\n    console.log(\"instance-modalFormList\", data);\n    console.log(\"key-modalFormList\", this.state.menuKey);\n    const modalFormList = [\n      {\n        type: \"INPUT\",\n        label: \"Hostname\",\n        name: \"hostname\",\n        field: \"Change Hostname\",\n        placeholder: \"Please input Hostname\",\n        width: \"90%\",\n        initialValue: data.Hostname,\n        id: data.ID,\n      },\n      {\n        type: \"SELECT\",\n        width: \"200px\",\n        label: \"Hyper\",\n        name: \"hyper\",\n        field: \"Migrate Instance\",\n        // disabled:true,\n        initialValue: data.Hyper,\n        id: data.ID,\n      },\n      {\n        type: \"SELECT\",\n        width: \"200px\",\n        label: \"Flavor\",\n        field: \"Resize Instance\",\n        name: \"flavor\",\n        initialValue: data.FlavorID,\n        id: data.ID,\n      },\n      {\n        type: \"SELECT\",\n        label: \"Action\",\n        name: \"action\",\n        field: \"Change Status\",\n        placeholder: \"Please Select Status\",\n        width: \"90%\",\n        // disabled:true,\n        initialValue: data.Status,\n        id: data.ID,\n      },\n    ];\n    return modalFormList;\n  };\n  handleSubmit = (data) => {\n    const id = this.state.everyData && this.state.everyData.ID;\n    if (id) {\n      const hostname = this.state.everyData && this.state.everyData.Hostname;\n      const hyper = this.state.everyData && this.state.everyData.Hyper;\n      const action = this.state.everyData && this.state.everyData.Status;\n      const flavor = this.state.everyData && this.state.everyData.FlavorID;\n      // const ifaces = this.state.everyData.Interfaces[0].Address.SubnetID;\n      let ifaces = [];\n\n      this.state.everyData &&\n        this.state.everyData.Interfaces.map((item) => {\n          ifaces.push(`${item.Address.SubnetID}`);\n          return ifaces;\n        });\n\n      let initInstance = {};\n      initInstance[\"hostname\"] = hostname;\n      initInstance[\"hyper\"] = hyper;\n      initInstance[\"action\"] = action;\n      initInstance[\"flavor\"] = flavor;\n      initInstance[\"ifaces\"] = ifaces;\n      this.setState(\n        {\n          updateInstance: initInstance,\n        },\n        () => {\n          if (data.hostname) {\n            initInstance.hostname = data.hostname;\n          } else if (data.hyper) {\n            initInstance.hyper = data.hyper;\n          } else if (data.flavor) {\n            initInstance.flavor = data.flavor;\n          } else if (data.action) {\n            initInstance.action = data.action;\n          }\n          let dataInstance = Object.assign(\n            {},\n            this.state.updateInstance,\n            initInstance,\n            data\n          );\n          console.log(\"dataInstance\", dataInstance);\n          this.handleUpdateList(id, dataInstance);\n        }\n      );\n    }\n  };\n  handleUpdateList = (id, paramsObj) => {\n    console.log(\"hangleUpdateList\", paramsObj, id);\n    if (id) {\n      editInsInfor(id, paramsObj)\n        .then((res) => {\n          // let _json = res.data;\n          // if (_json.return_code === \"0\") {\n          console.log(\"handleUpdateList-editInsInfor:\", res);\n          // } else {\n          //   message.error(res.message);\n          // }\n          this.loadData(this.state.current, this.state.pageSize);\n        })\n        .catch((err) => {\n          console.log(\"handleUpdateList-error:\", err);\n        });\n    }\n\n    this.modalRef.props.form.resetFields();\n    this.setState({\n      visible: false,\n    });\n  };\n\n  render() {\n    const { data, everyData } = this.state;\n    console.log(data, \"data\");\n    return (\n      <div>\n        <Row>\n          <Col span={24}>\n            <Card\n              title={\n                \"Instance Manage Panel\" + \"(Total: \" + this.state.total + \")\"\n              }\n              extra={\n                <Button\n                  type=\"primary\"\n                  size=\"small\"\n                  onClick={this.createInstance}\n                >\n                  Create\n                </Button>\n              }\n            >\n              <Row>\n                <Col span={24}>\n                  <DataTable\n                    rowKey=\"ID\"\n                    columns={this.columns}\n                    dataSource={this.state.instances}\n                    bordered\n                    total={this.state.total}\n                    pageSize={this.state.pageSize}\n                    // scroll={{ y: 600, x: 600 }}\n                    onPaginationChange={this.onPaginationChange}\n                    onShowSizeChange={this.onShowSizeChange}\n                    pageSizeOptions={this.state.pageSizeOptions}\n                    loading={!this.state.isLoaded}\n                  />\n                  <InstModal\n                    onRef={this.onModalRef}\n                    visible={this.state.visible}\n                    modalFormList={this.modalFormList(everyData)}\n                    title={this.state.title}\n                    submit={this.handleSubmit.bind(this)}\n                    close={() => {\n                      this.setState({\n                        visible: false,\n                        everyData: {},\n                      });\n                      this.modalRef.props.form.resetFields();\n                    }}\n                  />\n                </Col>\n              </Row>\n            </Card>\n          </Col>\n        </Row>\n      </div>\n    );\n  }\n}\nexport default Instances;\n"]},"metadata":{},"sourceType":"module"}